<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Carregando... - BAEFLIX</title>
    <link href="https://i.ibb.co/PGJ87dN5/cineveo-logo-r.png" rel="icon" type="image/png"/>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0A;
        }
        
        /* ESTILOS PARA O NOVO PLAYER (PLYR) */
        :root {
            --plyr-color-main: #E50914; /* Cor principal (vermelho BAEFLIX) */
            --plyr-font-family: 'Inter', sans-serif;
        }

        .loader {
            border: 4px solid #4A4A4A;
            border-top: 4px solid #E50914;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-black text-gray-300">

<header class="bg-gray-900/50 backdrop-blur-md shadow-lg sticky top-0 z-40 border-b border-gray-800">
    <nav class="container mx-auto px-4 sm:px-6 py-3 flex items-center justify-between gap-4">
        <a aria-label="Página Inicial" href="/index.html">
            <img alt="Logo BAEFLIX" class="h-16 w-auto" src="https://i.ibb.co/XrGt6ymb/Chat-GPT-Image-14-de-ago-de-2025-23-47-40.png"/>
        </a>
    </nav>
</header>

<main class="container mx-auto p-4 md:p-8">
    <div class="mb-4">
        <h1 class="text-2xl md:text-4xl font-black text-white mb-4" id="video-title">Carregando informações do filme...</h1>
    </div>
    
    <div id="player-container" class="w-full bg-black rounded-lg shadow-2xl overflow-hidden mb-8">
        <video id="player" playsinline controls>
            </video>
    </div>
</main>

<script type="module">
    document.addEventListener('DOMContentLoaded', async () => {
        const TMDB_API_KEY = "cf64e357f3a003e17687bb93cb692d6e";
        const STREAM_API_URLS = [
          "https://baby-beamup.club/stream/movie",
          "https://da5f663b4690-skyflixfork.baby-beamup.club/stream/movie",
        ];
        // O "serviço de ponte" para evitar o bloqueio de conexão
        const CORS_PROXY = "https://corsproxy.io/?";

        const titleElement = document.getElementById('video-title');
        const playerContainer = document.getElementById('player-container');

        // Mostra o loader enquanto tudo carrega
        playerContainer.innerHTML = `
            <div class="aspect-video w-full flex items-center justify-center flex-col bg-black rounded-lg">
                <div class="loader"></div>
                <p class="mt-4 text-gray-400">Buscando link do stream...</p>
            </div>`;

        const urlParams = new URLSearchParams(window.location.search);
        const tmdbId = urlParams.get('id');

        if (!tmdbId) {
            titleElement.textContent = "Erro: ID do filme não encontrado na URL.";
            playerContainer.innerHTML = `<div class="aspect-video w-full flex items-center justify-center"><p class="text-red-500">Não foi possível carregar o player.</p></div>`;
            return;
        }

        try {
            // Busca os detalhes do filme no TMDB para mostrar o título
            const tmdbDetailsResponse = await fetch(`https://api.themoviedb.org/3/movie/${tmdbId}?api_key=${TMDB_API_KEY}&language=pt-BR`);
            const movieDetails = await tmdbDetailsResponse.json();
            if (movieDetails.title) {
                titleElement.textContent = movieDetails.title;
                document.title = `Assistindo: ${movieDetails.title} - BAEFLIX`;
            }

            // Busca o IMDb ID, necessário para a API de stream
            const externalIdsResponse = await fetch(`https://api.themoviedb.org/3/movie/${tmdbId}/external_ids?api_key=${TMDB_API_KEY}`);
            const ids = await externalIdsResponse.json();
            const imdbId = ids.imdb_id;
            if (!imdbId) throw new Error("IMDb ID não encontrado para este filme.");

            let streamUrl = null;

            // Tenta buscar o stream em cada uma das fontes
            for (const baseUrl of STREAM_API_URLS) {
                const fullUrl = `${baseUrl}/${imdbId}.json`;
                try {
                    // **A MÁGICA ACONTECE AQUI**: Usamos o proxy para fazer a chamada
                    const streamApiResponse = await fetch(CORS_PROXY + encodeURIComponent(fullUrl));
                    if (streamApiResponse.ok) {
                        const streamData = await streamApiResponse.json();
                        if (streamData.streams && streamData.streams.length > 0) {
                            streamUrl = streamData.streams[0].url;
                            break; // Se encontrou, para de procurar
                        }
                    }
                } catch (e) { /* Tenta a próxima URL */ }
            }
            
            if (streamUrl) {
                // Se encontrou um link, substitui o loader pelo player de vídeo real
                playerContainer.innerHTML = `<video id="player" playsinline controls data-poster="${'https://image.tmdb.org/t/p/original' + movieDetails.backdrop_path}"><source src="${streamUrl}" type="video/mp4" /></video>`;
                
                // INICIA O PLAYER BONITO (PLYR)
                const player = new Plyr('#player');
            } else {
                throw new Error("Nenhum stream disponível foi encontrado em nenhuma das fontes.");
            }

        } catch (error) {
            console.error("Erro final ao carregar o player:", error);
            titleElement.textContent = "Erro ao carregar o filme";
            playerContainer.innerHTML = `<div class="aspect-video w-full flex items-center justify-center text-center p-4"><p class="text-red-500">${error.message}</p></div>`;
        }
    });
</script>

</body>
</html>
